<script>
    const repoOwner = "banpobanpo";  // 본인 GitHub ID
    const repoName = "DailyNotice";  // JSON 파일이 있는 저장소 이름
    const filePath = "data.json";  // JSON 파일 경로
    const accessToken = "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";  // GitHub Token

    async function updateData() {
        let updatedData = {};
        for (let i = 1; i <= 16; i++) {
            updatedData[`info${i}`] = document.getElementById(`info${i}`).value;
        }

        console.log("🔹 업데이트할 데이터:", updatedData); // 디버깅

        // 기존 JSON 파일의 SHA 값 가져오기
        const getFile = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
            headers: { "Authorization": `token ${accessToken}` }
        });

        if (!getFile.ok) {
            console.error("❌ 파일을 가져오는 데 실패했습니다.", await getFile.text());
            alert("파일을 가져오는 데 실패했습니다. GitHub Token 및 Repository 설정을 확인하세요.");
            return;
        }

        const fileData = await getFile.json();
        const sha = fileData.sha;
        console.log("🔹 현재 SHA 값:", sha);

        const updatePayload = {
            message: "Update data.json",
            content: btoa(JSON.stringify(updatedData, null, 2)),  // Base64 인코딩
            sha: sha
        };

        const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
            method: "PUT",
            headers: {
                "Authorization": `token ${accessToken}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify(updatePayload)
        });

        const responseData = await response.json();
        console.log("🔹 GitHub 응답:", responseData); // 디버깅

        if (response.ok) {
            alert("✅ 데이터가 성공적으로 업데이트되었습니다.");
            loadData();
        } else {
            console.error("❌ 업데이트 실패:", responseData);
            alert("업데이트 실패: " + responseData.message);
        }
    }
</script>
