<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ë°ì´í„° ê´€ë¦¬</title>
    <script>
        const repoOwner = "banpobanpo";  // ë³¸ì¸ GitHub ID
        const repoName = "DailyNotice";  // JSON íŒŒì¼ì´ ìˆëŠ” ì €ì¥ì†Œ ì´ë¦„
        const filePath = "data.json";  // JSON íŒŒì¼ ê²½ë¡œ

        // 1. JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadData() {
            try {
                const response = await fetch(`https://raw.githubusercontent.com/banpobanpo/DailyNotice/main/${filePath}`);
                if (!response.ok) throw new Error("ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨");
                const data = await response.json();

                let content = "<h2>ğŸ“Œ í˜„ì¬ ë°ì´í„°</h2><ul>";
                Object.keys(data).forEach(key => {
                    content += `<li><b>${key}:</b> ${data[key]}</li>`;
                });
                content += "</ul>";
                document.getElementById("dataDisplay").innerHTML = content;
            } catch (error) {
                console.error(error);
                document.getElementById("dataDisplay").innerText = "ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
            }
        }

        // 2. ê´€ë¦¬ì ëª¨ë“œ - ë°ì´í„° ìˆ˜ì • í¼ í‘œì‹œ
        function showAdmin() {
            let formHTML = '<h2>ë°ì´í„° ìˆ˜ì •</h2><form id="editForm">';
            for (let i = 1; i <= 16; i++) {
                formHTML += `<label>info${i}: <input type="text" id="info${i}" /></label><br/>`;
            }
            formHTML += `<button type="button" onclick="updateData()">ì—…ë°ì´íŠ¸</button></form>`;
            document.getElementById("adminPanel").innerHTML = formHTML;
        }

        // 3. GitHub APIë¥¼ ì´ìš©í•œ JSON íŒŒì¼ ì—…ë°ì´íŠ¸
        async function updateData() {
            let updatedData = {};
            for (let i = 1; i <= 16; i++) {
                updatedData[`info${i}`] = document.getElementById(`info${i}`).value;
            }

            const response = await fetch(`https://api.github.com/repos/banpobanpo/DailyNotice/dispatches`, {
                method: "POST",
                headers: {
                    "Accept": "application/vnd.github.v3+json",
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    event_type: "update-json",
                    client_payload: { updatedData }
                })
            });

            if (response.ok) {
                alert("âœ… ë°ì´í„°ê°€ ì—…ë°ì´íŠ¸ ìš”ì²­ë˜ì—ˆìŠµë‹ˆë‹¤!");
            } else {
                const errorText = await response.text();
                alert("âŒ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨! ${errorText}");
            }
        }

        window.onload = loadData;
    </script>
</head>
<body>
    <h1>JSON ë°ì´í„° ê´€ë¦¬</h1>
    <div id="dataDisplay"></div>
    <button onclick="showAdmin()">ê´€ë¦¬ì ëª¨ë“œ</button>
    <div id="adminPanel"></div>
</body>
</html>
