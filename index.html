<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON 데이터 관리</title>
    <script>
        const repoOwner = "banpobanpo";  // 본인 GitHub ID
        const repoName = "DailyNotice";  // JSON 파일이 있는 저장소 이름
        const filePath = "data.json";  // JSON 파일 경로
        const accessToken = "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";  // GitHub Personal Access Token (보안 유의!)

        // 1. JSON 데이터 불러오기
        async function loadData() {
            const response = await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}`);
            const data = await response.json();
            
            let content = "<h2>현재 데이터</h2><ul>";
            Object.keys(data).forEach(key => {
                content += `<li><b>${key}:</b> ${data[key]}</li>`;
            });
            content += "</ul>";
            document.getElementById("dataDisplay").innerHTML = content;
        }

        // 2. 관리자 모드 - 데이터 수정 폼 표시
        function showAdmin() {
            let formHTML = '<h2>데이터 수정</h2><form id="editForm">';
            for (let i = 1; i <= 16; i++) {
                formHTML += `<label>info${i}: <input type="text" id="info${i}" /></label><br/>`;
            }
            formHTML += `<button type="button" onclick="updateData()">업데이트</button></form>`;
            document.getElementById("adminPanel").innerHTML = formHTML;
        }

        // 3. GitHub API를 이용한 JSON 파일 업데이트
        async function updateData() {
            let updatedData = {};
            for (let i = 1; i <= 16; i++) {
                updatedData[`info${i}`] = document.getElementById(`info${i}`).value;
            }

            const getFile = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`);
            const fileData = await getFile.json();
            const sha = fileData.sha;  // 기존 파일의 SHA 값 필요

            const updatePayload = {
                message: "Update data.json",
                content: btoa(JSON.stringify(updatedData, null, 2)),  // Base64 인코딩
                sha: sha
            };

            const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
                method: "PUT",
                headers: {
                    "Authorization": `token ${accessToken}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify(updatePayload)
            });

            if (response.ok) {
                alert("데이터가 성공적으로 업데이트되었습니다.");
                loadData();
            } else {
                alert("업데이트 실패");
            }
        }

        window.onload = loadData;
    </script>
</head>
<body>
    <h1>JSON 데이터 관리</h1>
    <div id="dataDisplay"></div>
    <button onclick="showAdmin()">관리자 모드</button>
    <div id="adminPanel"></div>
</body>
</html>
