<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON ë°ì´í„° ê´€ë¦¬</title>
    <script>
        const repoOwner = "banpobanpo";  // ë³¸ì¸ GitHub ID
        const repoName = "DailyNotice";  // JSON íŒŒì¼ì´ ìˆëŠ” ì €ì¥ì†Œ ì´ë¦„
        const filePath = "data.json";  // JSON íŒŒì¼ ê²½ë¡œ
        const accessToken = "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";  // GitHub Personal Access Token (ë³´ì•ˆ ìœ ì˜!)

        // 1. JSON ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        async function loadData() {
            const response = await fetch(`https://raw.githubusercontent.com/${repoOwner}/${repoName}/main/${filePath}`);
            const data = await response.json();
            
            let content = "<h2>í˜„ì¬ ë°ì´í„°</h2><ul>";
            Object.keys(data).forEach(key => {
                content += `<li><b>${key}:</b> ${data[key]}</li>`;
            });
            content += "</ul>";
            document.getElementById("dataDisplay").innerHTML = content;
        }

        // 2. ê´€ë¦¬ì ëª¨ë“œ - ë°ì´í„° ìˆ˜ì • í¼ í‘œì‹œ
        function showAdmin() {
            let formHTML = '<h2>ë°ì´í„° ìˆ˜ì •</h2><form id="editForm">';
            for (let i = 1; i <= 16; i++) {
                formHTML += `<label>info${i}: <input type="text" id="info${i}" /></label><br/>`;
            }
            formHTML += `<button type="button" onclick="updateData()">ì—…ë°ì´íŠ¸</button></form>`;
            document.getElementById("adminPanel").innerHTML = formHTML;
        }

        // 3. GitHub APIë¥¼ ì´ìš©í•œ JSON íŒŒì¼ ì—…ë°ì´íŠ¸
        async function updateData() {
        let updatedData = {};
        for (let i = 1; i <= 16; i++) {
            updatedData[`info${i}`] = document.getElementById(`info${i}`).value;
        }

        console.log("ğŸ”¹ ì—…ë°ì´íŠ¸í•  ë°ì´í„°:", updatedData); // ë””ë²„ê¹…

        // ê¸°ì¡´ JSON íŒŒì¼ì˜ SHA ê°’ ê°€ì ¸ì˜¤ê¸°
        const getFile = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
            headers: { "Authorization": `token ${accessToken}` }
        });

        if (!getFile.ok) {
            console.error("âŒ íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.", await getFile.text());
            alert("íŒŒì¼ì„ ê°€ì ¸ì˜¤ëŠ” ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. GitHub Token ë° Repository ì„¤ì •ì„ í™•ì¸í•˜ì„¸ìš”.");
            return;
        }

        const fileData = await getFile.json();
        const sha = fileData.sha;
        console.log("ğŸ”¹ í˜„ì¬ SHA ê°’:", sha);

        const updatePayload = {
            message: "Update data.json",
            content: btoa(JSON.stringify(updatedData, null, 2)),  // Base64 ì¸ì½”ë”©
            sha: sha
        };

        const response = await fetch(`https://api.github.com/repos/${repoOwner}/${repoName}/contents/${filePath}`, {
            method: "PUT",
            headers: {
                "Authorization": `token ${accessToken}`,
                "Content-Type": "application/json"
            },
            body: JSON.stringify(updatePayload)
        });

            if (response.ok) {
                alert("ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.");
                loadData();
            } else {
                alert("ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
            }
        }

        window.onload = loadData;
    </script>
</head>
<body>
    <h1>JSON ë°ì´í„° ê´€ë¦¬</h1>
    <div id="dataDisplay"></div>
    <button onclick="showAdmin()">ê´€ë¦¬ì ëª¨ë“œ</button>
    <div id="adminPanel"></div>
</body>
</html>
